<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đèn trời Trung Thu</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000014;
      font-family: "Arial", sans-serif;
    }
    canvas {
      display: block;
    }
    .message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px 30px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      font-size: 20px;
      font-weight: bold;
      color: #b36b00;
      text-align: center;
      opacity: 0;
      transition: opacity 1s ease;
      max-width: 70%;
    }
    .message.show {
      opacity: 1;
    }
    .message img {
      max-width: 250px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <canvas id="sky"></canvas>
  <div id="msgBox" class="message"></div>

  <!-- Nhạc nền -->
  <audio id="bgMusic" src="music.mp3" autoplay loop></audio>

  <script>
    const canvas = document.getElementById("sky");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // --- Vẽ sao ---
    const stars = [];
    for (let i = 0; i < 150; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.5,
        alpha: Math.random(),
        delta: 0.02 * (Math.random() < 0.5 ? 1 : -1)
      });
    }
    function drawStars() {
      for (let star of stars) {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
        ctx.fill();
        star.alpha += star.delta;
        if (star.alpha <= 0 || star.alpha >= 1) star.delta *= -1;
      }
    }

    // --- Vẽ mặt trăng ---
    function drawMoon() {
      const x = canvas.width - 150;
      const y = 150;
      ctx.beginPath();
      ctx.arc(x, y, 50, 0, Math.PI * 2, false);
      ctx.fillStyle = "white";
      ctx.shadowColor = "rgba(255,255,200,0.8)";
      ctx.shadowBlur = 40;
      ctx.fill();
      ctx.shadowBlur = 0;
    }

    // --- Class đèn trời ---
    class Lantern {
      constructor(img) {
        this.img = img;
        this.x = Math.random() * canvas.width;
        this.y = canvas.height + Math.random() * 200;
        this.size = Math.random() * 40 + 50;
        this.speed = Math.random() * 1 + 0.5;
      }
      draw() {
        ctx.drawImage(this.img, this.x - this.size/2, this.y - this.size, this.size, this.size * 1.3);
      }
      update() {
        this.y -= this.speed;
        if (this.y < -100) {
          this.y = canvas.height + 50;
          this.x = Math.random() * canvas.width;
        }
        this.draw();
      }
      isClicked(mx, my) {
        return (mx > this.x - this.size/2 &&
                mx < this.x + this.size/2 &&
                my > this.y - this.size &&
                my < this.y);
      }
    }

    // --- Load ảnh đèn PNG ---
    let lanterns = [];
    const lanternImg = new Image();
    lanternImg.src = "lantern.png";

    lanternImg.onload = () => {
      for (let i = 0; i < 40; i++) {
        lanterns.push(new Lantern(lanternImg));
      }
    };

    // --- Animation ---
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawStars();
      drawMoon();
      lanterns.forEach(lantern => lantern.update());
      requestAnimationFrame(animate);
    }
    animate();

    // --- Danh sách gốc (lời chúc & ảnh) ---
    const allMessages = [
      "Ước mong mọi người đều sum vầy và hạnh phúc trong đêm Trung Thu.",
      "Chúc bạn luôn bình an và hạnh phúc như ánh trăng rằm.",
      "Mong tình yêu và tình bạn luôn bền lâu như trăng rằm.",
      "Chúc con đường phía trước của bạn luôn sáng rực như ánh đèn lồng.",
      "Trung Thu trăng sáng, cầu chúc bạn luôn tươi vui và may mắn.",
      { type: "image", src: "anh1.jpg" },
      { type: "image", src: "anh3.jpg" },
      "Thế giới mong bạn lớn, còn em mong bạn bình an",
      "Vui lên nhé, dù thế nào vẫn còn em ở đây",
      "Trăng đêm nay đẹp nhỉ?",
      "Chúc bạn tất cả trừ vất vả",
      "Bạn rất tốt rồi, cố lên nhé",
      "Trung thu này hông có quà cho bạn rùi, tặng em cho bạn nhá"

    ];

    let messages = [...allMessages];
    const msgBox = document.getElementById("msgBox");

    function showMessage(content) {
      msgBox.innerHTML = "";
      if (typeof content === "string") {
        msgBox.textContent = content;
      } else if (content.type === "image") {
        const img = document.createElement("img");
        img.src = content.src;
        msgBox.appendChild(img);
      }
      msgBox.classList.add("show");
      setTimeout(() => {
        msgBox.classList.remove("show");
      }, 4000);
    }

    // --- Click vào đèn ---
    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;

      for (let lantern of lanterns) {
        if (lantern.isClicked(mx, my)) {
          if (messages.length === 0) {
            messages = [...allMessages]; // reset khi hết
          }
          const idx = Math.floor(Math.random() * messages.length);
          const content = messages[idx];
          showMessage(content);
          messages.splice(idx, 1); // loại phần tử đã dùng
          break;
        }
      }
    });

    // --- Responsive ---
    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    // --- Fix autoplay nhạc trên mobile ---
    const bgMusic = document.getElementById("bgMusic");
    document.body.addEventListener("click", () => {
      if (bgMusic.paused) bgMusic.play();
    }, { once: true });
  </script>
</body>
</html>
